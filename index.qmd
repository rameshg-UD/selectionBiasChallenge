---
#title: "Selection Bias & Missing Data Challenge"
#subtitle: "Static Meme Creation using a puppy image"
format:
  html: 
    mainfont: Times New Roman
execute:
  echo: false
  eval: true
---

# üé® Selection Bias & Missing Data Challenge

 Selection bias occurs when observed data isn‚Äôt representative of the population. The below meme demonstrate this concept through visual metaphor:

* **Reality:** The original image of the puppy represents the true population
* **Your Model:** The stippled image represents the sample data collection (sampling)
* **Selection Bias:** A bold letter ‚ÄúS‚Äù represents a systematic pattern of missing data
* **Estimate:** The final Stippled image with ‚ÄúS‚Äù mask applied shows the biased estimate

```{python}
#| label: set_environment
#| echo: false
import numpy as np
import matplotlib.pyplot as plt

```

::: {.callout-note title="Reality" icon=false}
```{python}
#| label: prepare_image
#| fig-cap: "Original image prepared for processing"

from step1_prepare_image import prepare_image

# Load and prepare the image
img_path = 'puppy.jpeg'
gray_image = prepare_image(img_path, max_size=512)

# Display the prepared image
fig, ax = plt.subplots(figsize=(6.5, 5))
ax.imshow(gray_image, cmap='gray', vmin=0, vmax=1)
ax.axis('off')
ax.set_title('Prepared Image', fontsize=14, fontweight='bold', pad=10)
plt.tight_layout()
plt.show()
```
:::

::: {.callout-note title="Model" icon=false}
```{python}
#| label: create_stipple
#| echo: false
#| fig-cap: "Blue noise stippling pattern"

from step2_create_stipple import create_stipple

# Create stippled image
stipple_pattern, samples = create_stipple(
    gray_image,
    percentage=0.08,  # 8% of pixels will be stippled
    sigma=0.9,  # Repulsion radius
    content_bias=0.9,  # Strongly follow importance map
    noise_scale_factor=0.1,  # Moderate exploration
    extreme_downweight=0.5,  # Moderate downweighting of extremes
    extreme_threshold_low=0.2,  # Downweight tones below 0.2
    extreme_threshold_high=0.8,  # Downweight tones above 0.8
    extreme_sigma=0.1  # Smooth transition width
)

# Display the stippled image
fig, ax = plt.subplots(figsize=(6.5, 5))
ax.imshow(stipple_pattern, cmap='gray', vmin=0, vmax=1)
ax.axis('off')
ax.set_title('Stippled Puppy Image', fontsize=14, fontweight='bold', pad=10)
plt.tight_layout()
plt.show()
```
:::

::: {.callout-note title="Selection Bias" icon=false}
```{python}
#| label: create_block_letter
#| fig-cap: "Block letter S representing selection bias"


from step4_create_block_letter import Create_block_letter
# 
# Get image dimensions
h, w = gray_image.shape

# # Create block letter S 
block_letter = Create_block_letter(h, w, letter="S", font_size_ratio=0.9)
# 
# # Display the block letter
fig, ax = plt.subplots(figsize=(6.5, 5))
ax.imshow(block_letter, cmap='gray', vmin=0, vmax=1)
ax.axis('off')
ax.set_title('Selection Bias (Block Letter S)', fontsize=14, fontweight='bold',pad=50)
plt.tight_layout()
plt.show()
```
:::

::: {.callout-note title="Estimate" icon=false}
```{python}
#| label: Create-masked-Stippled
#| fig-cap: "Masked stippled image showing selection bias effect"


# UNCOMMENT AND USE THIS ONCE YOU'VE WRITTEN step5_create_masked.py:
from step5_create_masked import create_masked_stipple
# 
# # Create masked stippled image
masked_stipple = create_masked_stipple(
     stipple_pattern,
     block_letter,
     threshold=0.5  # Pixels below 0.5 are considered part of the mask
 )
# 
# # Display the masked image
fig, ax = plt.subplots(figsize=(6.5, 5))
ax.imshow(masked_stipple, cmap='gray', vmin=0, vmax=1)
ax.axis('off')
ax.set_title('Masked Stippled Image (Estimate)', fontsize=14, fontweight='bold', pad=10)
plt.tight_layout()
plt.show()
```
:::

::: {.callout-note title="Statistics Meme" icon=false}
```{python}
#| label: create-final-meme
#| fig-cap: "Statistics meme demonstrating selection bias"


# UNCOMMENT AND USE THIS ONCE YOU'VE WRITTEN create_meme.py:
from create_meme import create_statistics_meme
# 
# # Create the final meme
create_statistics_meme(
     original_img=gray_image,
     stipple_img=stipple_pattern,
     block_letter_img=block_letter,
     masked_stipple_img=masked_stipple,
     output_path="my_statistics_meme.png",
     dpi=250,
     background_color="lightgray"  # or "pink", "lightgray", etc.
 )
from IPython.display import Image, display
display(Image("my_statistics_meme.png"))
```
:::

#### <font color="Blue">Selection bias causes your estimate to converge to the wrong value because the observed data do not represent the population of interest. </font>